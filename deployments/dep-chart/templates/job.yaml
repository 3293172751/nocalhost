apiVersion: batch/v1
kind: Job
metadata:
  name: nocalhost-dep-installer-{{ .Release.Revision }}
  namespace: {{ .Values.depNamespace | default "nocalhost-reserved" }}
spec:
  template:
    spec:
      containers:
      - command:
        - /nocalhost/installer.sh
        image: {{ .Values.image.repository }}:{{ .Values.image.tag | default "latest" }}
        imagePullPolicy: IfNotPresent
        name: nocalhost-dep-installer
        env:
          - name: NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
      restartPolicy: Never
      serviceAccount: nocalhost-dep-admin
      serviceAccountName: nocalhost-dep-admin
